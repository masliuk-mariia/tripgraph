(()=>{"use strict";let t;const e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];class s{constructor(t="database.json"){this.startDate_s=0,this.endDate_s=0,this.galleryItems=[],this.sortItems=[],this.url=t,this.container=document.querySelector(".trips__row")}set startDate(t){if(0==t)return void(this.startDate_s=0);let e=new Date(t).toISOString();e=Date.parse(e),this.startDate_s=e}get startDate(){const t=new Date(this.startDate_s);return e[t.getMonth()]+" "+t.getDate()}set endDate(t){if(0==t)return void(this.endDate_s=0);let e=new Date(t).toISOString();e=Date.parse(e),this.endDate_s=e}get endDate(){const t=new Date(this.endDate_s);return e[t.getMonth()]+" "+t.getDate()}fetchItems(){(async t=>{const e=await fetch(t);if(!e.ok)throw new Error("Can't fetch data from ${url}, status: ${res.status}");return await e.json()})(this.url).then((t=>this.readItems(t.gallery))).catch((t=>console.log(t)))}readItems(t){t.forEach((t=>{const e={};e.title=t.title,e.rating=t.rating,e.date_start=new Date(t.date_start).toISOString(),e.ms_start=Date.parse(e.date_start),e.date_end=new Date(t.date_end).toISOString(),e.ms_end=Date.parse(e.date_end),e.img=t.img,e.descr=t.descr,this.galleryItems.push(e)})),this.sortItems=this.filterItems(),this.showItems()}filterItems(){if(0==this.startDate_s||0==this.endDate_s)return this.galleryItems;const t=this.startDate_s,e=this.endDate_s,s=this.galleryItems.filter((function(s){return s.ms_start>=t&&s.ms_start<=e}));return s.sort(((t,e)=>t.ms_start-e.ms_start)),s}makeTime(t,s){const n=new Date(t),a=new Date(s),r=n.getDate(),o=e[n.getMonth()],c=a.getDate();return`<time><span>${o}</span> ${r}</time> - \n    <time><span>${e[a.getMonth()]}</span> ${c}</time>`}showItems(){this.container.innerHTML="";const t=document.querySelector(".calendar__descr");0==this.sortItems.length?t.textContent="No travel during this period.":t.textContent=`Found ${this.sortItems.length} trips.`,this.sortItems.forEach((t=>{const e=document.createElement("div");for(let s=1;s<6;s++){const n=document.createElement("span");n.classList.add("icon-star"),t.rating>=s&&n.classList.add("checked"),e.append(n)}const s=this.makeTime(t.date_start,t.date_end),n=document.createElement("div");n.classList.add("trips__column"),n.innerHTML=`\n      <div class="trips__item">\n      <div class="trips__image _ibg">\n        <img src="${t.img}" alt="">\n        <div class="trips__title">${t.title}</div>\n        <div class="trips__rating">${e.innerHTML}</div>\n      </div>\n      <div class="trips__card">\n        <div class="trips__label">\n          <div class="trips__date">\n            ${s}\n          </div>\n          <a  class="trips__link" href="#">&gt;</a>\n        </div>\n        <div class="trips__descr">${t.descr}</div>\n      </div>\n    </div>\n      `,this.container.append(n)}))}}function n(t){for(let e=1;e<=31;e++){const s=document.createElement("option");let n=e;n<10&&(n="0"+n),s.value=n,s.innerHTML=e,t.append(s)}}function a(t){e.forEach(((e,s)=>{const n=document.createElement("option");let a=s+1;a<10&&(a="0"+a),n.value=a,n.innerHTML=e,t.append(n)}))}!function(t){let e=new Image;e.onload=e.onerror=function(){!function(t){let e=!0===t?"webp":"no-webp";document.documentElement.classList.add(e)}(2==e.height)},e.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}(),function(){const t=document.querySelector(".nav__body");t&&t.querySelectorAll(".nav__link").forEach((t=>{t.href==window.location.href&&t.parentElement.classList.add("nav__item_active")}))}(),function(){const t=document.querySelector("#register_frm");t&&t.addEventListener("submit",(t=>{t.preventDefault(),document.location.href="trips.html"}))}(),function(){if(!document.querySelector(".trips__row"))return;!function(){const e=document.querySelector(".calendar__title"),s=document.querySelector(".calendar__descr"),r=document.querySelector("#calendar_search"),o=document.querySelector(".calendar__frm"),c=o.querySelector("#date_from_day"),i=o.querySelector("#date_to_day"),d=o.querySelector("#date_from_month"),l=o.querySelector("#date_to_month");n(c),n(i),a(d),a(l),r.addEventListener("click",(n=>{n.preventDefault();const a="2022-"+d.value+"-"+c.value,r="2022-"+l.value+"-"+i.value;t.startDate=a,t.endDate=r,t.sortItems=t.filterItems(),t.showItems(),e.style.display="block",s.style.display="block",document.querySelector("#title_from-date").textContent=t.startDate,document.querySelector("#title_to-date").textContent=t.endDate,document.querySelector(".calendar").classList.remove("show"),document.querySelector(".calendar").classList.add("hide")})),document.querySelector("#calendar_close").addEventListener("click",(t=>{t.preventDefault(),document.querySelector(".calendar").classList.remove("show"),document.querySelector(".calendar").classList.add("hide")})),document.querySelector("#calendar_show").addEventListener("click",(t=>{t.preventDefault(),document.querySelector(".calendar").classList.remove("hide"),document.querySelector(".calendar").classList.add("show")}))}(),t=new s("files/database.json"),t.fetchItems();const e=document.querySelector("#list_show");e&&e.addEventListener("click",(e=>{e.preventDefault(),document.querySelector(".calendar__title").style.display="none",document.querySelector(".calendar__descr").style.display="none",t.startDate=0,t.endDate=0,t.sortItems=t.filterItems(),t.showItems()}))}()})();